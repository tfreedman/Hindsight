<% if event[:type].start_with?('skype_message') %>
  <% kind = :sent if event[:content][:real_sender] == Hindsight::Application.credentials.real_name %>
  <% author = event[:content][:author] %>
  <% message = raw event[:content][:body_xml] %>
<% elsif event[:type].start_with?('adium_message') %>
  <% kind = :sent if event[:content][:real_sender] == Hindsight::Application.credentials.real_name %>
  <% author = event[:content][:real_sender] %>
  <% message = event[:content][:message].html_safe %>
<% elsif event[:type].start_with?('pidgin_message') %>
  <% kind = :sent if event[:content][:real_sender] == Hindsight::Application.credentials.real_name %>
  <% author = (event[:content][:real_sender] || event[:content][:sender]) %>
  <% message = event[:content][:message].html_safe %>
<% elsif event[:type].start_with?('facebook_message') %>
  <% kind = :sent if event[:content].room[:real_name] && (event[:content].room[:real_name] != event[:content][:sender_name]) %>
  <% author = event[:content][:sender_name] %>
  <% message = event[:content][:content] %>
<% elsif event[:type].start_with?('hangouts_event') %>
  <% kind = :sent if event[:content][:real_name] == Hindsight::Application.credentials.real_name %>
  <% author = event[:content][:real_name] %>
<% elsif event[:type].start_with?('google_talk_message_') %>
  <% kind = :sent if event[:content][:real_sender] == Hindsight::Application.credentials.real_name %>
  <% author = event[:content][:real_sender] %>
  <% message = event[:content][:message] %>
<% elsif event[:type].start_with?('google_chat_message_') %>
  <% kind = :sent if event[:content][:real_sender] == Hindsight::Application.credentials.real_name %>
  <% author = event[:content][:real_sender] %>
  <% message = event[:content][:text] %>
<% end %>
<header style="color: <%= colors2(@event_groups[event[:type]]) %>">
  <p class="<% if kind == :sent %>sent<% else %>received<% end %>">
    <small><%= author %></small>
  </p>
</header>
<div class="card-body">
  <p class="<% if kind == :sent %>sent<% else %>received<% end %>">
    <% if !event[:type].start_with?('hangouts_event') %>
      <%= message %>
    <% else %>
      <% begin %>
        <% event[:content][:chat_message]["message_content"]["segment"].each do |segment| %>
          <%= segment["text"] %>
        <% end %>
      <% rescue %>
        ???
      <% end %>
    <% end %>
  </p>
</div>
